<div class="board">
  <aside class="sidebar">
    <button mat-stroked-button color="primary" class="add-btn" (click)="openDialog()">
      {{ 'common.add' | transloco }}
    </button>

    <nav class="nav">
      <h4>{{ 'tasks.eyebrow' | transloco }}</h4>
      <button class="nav-item active" (click)="resetFilters()">
        {{ 'tasks.filters.all' | transloco }}
      </button>
      <button class="nav-item" (click)="toggleCompleted(false)">
        {{ 'tasks.filters.pending' | transloco }}
      </button>
      <button class="nav-item" (click)="toggleCompleted(true)">
        {{ 'tasks.filters.completed' | transloco }}
      </button>
    </nav>

    <div class="labels">
      <h4>Labels</h4>
      <button class="label-chip" *ngFor="let label of labels" (click)="filters.label = label; applyFilters()">
        <span class="dot" [ngClass]="label | lowercase"></span>
        {{ label }}
      </button>
    </div>
  </aside>

  <section class="board-content">
    <header class="board-toolbar">
      <div class="search">
        <input type="text" placeholder="{{ 'common.search' | transloco }}" [(ngModel)]="searchTerm" (keyup.enter)="applyFilters()" />
      </div>
      <div class="filters">
        <mat-form-field appearance="outline" class="w-44 dense">
          <mat-select [(ngModel)]="filters.priority" (selectionChange)="applyFilters()" [placeholder]="'tasks.priority' | transloco">
            <mat-option [value]="undefined">{{ 'tasks.filters.all' | transloco }}</mat-option>
            <mat-option *ngFor="let priority of priorities" [value]="priority">{{ priority }}</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" class="w-44 dense">
          <mat-select [(ngModel)]="filters.label" (selectionChange)="applyFilters()" [placeholder]="'tasks.label' | transloco">
            <mat-option [value]="undefined">{{ 'tasks.filters.all' | transloco }}</mat-option>
            <mat-option *ngFor="let label of labels" [value]="label">{{ label }}</mat-option>
          </mat-select>
        </mat-form-field>
        <button mat-stroked-button color="primary" (click)="loadTodos()" [disabled]="loading">
          {{ 'common.refresh' | transloco }}
        </button>
        <button mat-stroked-button color="primary" (click)="exportExcel()" [disabled]="loading || !source.length">
          {{ 'tasks.exportExcel' | transloco }}
        </button>
        <button mat-stroked-button color="primary" (click)="exportPdf()" [disabled]="loading || !source.length">
          {{ 'tasks.exportPdf' | transloco }}
        </button>
      </div>
    </header>

    <div class="table-wrapper">
      <div class="absolute inset-0 flex items-center justify-center" *ngIf="loading">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
      <div [class.opacity-50]="loading">
        <ng2-smart-table
          [settings]="settings"
          [source]="source"
          (custom)="onCustom($event)"
          class="smart-table"
        ></ng2-smart-table>
      </div>
    </div>

    <mat-paginator
      [length]="total"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="[5, 10, 20]"
      (page)="onPageChange($event)"
    ></mat-paginator>
  </section>
</div>
