<div class="board">
  <aside class="sidebar">
    <button mat-stroked-button color="primary" class="add-btn" (click)="openDialog()">
      <mat-icon>add</mat-icon>
      {{ 'common.add' | transloco }}
    </button>

    <nav class="nav">
      <h4><mat-icon>view_list</mat-icon> {{ 'tasks.eyebrow' | transloco }}</h4>
      <button class="nav-item active" (click)="resetFilters()">
        <mat-icon class="nav-icon">format_list_bulleted</mat-icon>
        {{ 'tasks.filters.all' | transloco }}
      </button>
      <button class="nav-item" (click)="toggleCompleted(false)">
        <mat-icon class="nav-icon">schedule</mat-icon>
        {{ 'tasks.filters.pending' | transloco }}
      </button>
      <button class="nav-item" (click)="toggleCompleted(true)">
        <mat-icon class="nav-icon">task_alt</mat-icon>
        {{ 'tasks.filters.completed' | transloco }}
      </button>
    </nav>

    <div class="labels">
      <h4><mat-icon>sell</mat-icon> Labels</h4>
      <button
        class="label-chip"
        *ngFor="let label of labels"
        (click)="toggleLabel(label)"
        [class.active]="isLabelSelected(label)"
      >
        <span class="dot" [style.background]="labelColor(label)"></span>
        {{ label }}
      </button>
      <button class="label-chip ghost" (click)="clearLabels()" [disabled]="!selectedLabels.length">
        {{ 'tasks.filters.all' | transloco }}
      </button>
    </div>
  </aside>

  <section class="board-content">
    <header class="board-toolbar">
      <div class="search">
        <mat-icon class="input-icon">search</mat-icon>
        <input type="text" placeholder="{{ 'common.search' | transloco }}" [(ngModel)]="searchTerm" (keyup.enter)="applyFilters()" />
      </div>
      <span class="result-badge" aria-live="polite">RÃ©sultats: {{ total }}</span>
      <div class="filters">
        <mat-form-field appearance="outline" class="w-44 dense">
          <mat-select [(ngModel)]="filters.priority" (selectionChange)="applyFilters()" [placeholder]="'tasks.priority' | transloco">
            <mat-option [value]="undefined">{{ 'tasks.filters.all' | transloco }}</mat-option>
            <mat-option *ngFor="let priority of priorities" [value]="priority">{{ priority }}</mat-option>
          </mat-select>
        </mat-form-field>
        <button mat-stroked-button color="primary" (click)="loadTodos()" [disabled]="loading">
          {{ 'common.refresh' | transloco }}
        </button>
        <button mat-stroked-button color="primary" (click)="exportExcel()" [disabled]="loading || !source.length">
          {{ 'tasks.exportExcel' | transloco }}
        </button>
        <button mat-stroked-button color="primary" (click)="exportPdf()" [disabled]="loading || !source.length">
          {{ 'tasks.exportPdf' | transloco }}
        </button>
      </div>
    </header>

    <div class="list-card">
      <div class="absolute inset-0 flex items-center justify-center" *ngIf="loading">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
      <div [class.opacity-50]="loading">
        <div class="list-row header">
          <span>{{ 'tasks.columns.title' | transloco }}</span>
          <span>{{ 'tasks.columns.person' | transloco }}</span>
          <span>{{ 'tasks.columns.labels' | transloco }}</span>
          <span>{{ 'tasks.columns.completed' | transloco }}</span>
          <span>{{ 'tasks.columns.startDate' | transloco }}</span>
          <span>{{ 'tasks.columns.endDate' | transloco }}</span>
          <span></span>
        </div>
        <div class="list-row" *ngFor="let todo of source">
          <div class="title-cell">
            <div class="title" [innerHTML]="highlightText(todo.title, searchTerm)"></div>
          </div>
          <div class="person-cell">
            <div class="avatar">{{ avatarInitials(todo) }}</div>
            <div
              class="subtitle strong"
              [innerHTML]="highlightText(todo.person?.name || ('tasks.unassigned' | transloco), searchTerm)"
            ></div>
          </div>
          <div class="labels-cell">
            <span class="label-dot" *ngFor="let label of todo.labels" [style.background]="labelColor(label)"></span>
          </div>
          <div class="status-cell">
            <span class="pill" [class.done]="todo.completed">
              {{ todo.completed ? ('common.yes' | transloco) : ('common.no' | transloco) }}
            </span>
          </div>
          <div class="date-cell">
            {{ todo.startDate }}
          </div>
          <div class="date-cell">
            {{ scheduleText(todo) }}
          </div>
          <div class="actions-cell">
            <button
              mat-icon-button
              (click)="toggleDone(todo)"
              [disabled]="todo.completed"
              aria-label="mark-done"
              [matTooltip]="todo.completed ? ('tasks.completedLock' | transloco) : ('tasks.markDone' | transloco)"
            >
              <mat-icon [class.done-icon]="todo.completed">{{ todo.completed ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
            </button>
            <button mat-icon-button (click)="openDialog(todo)" [disabled]="todo.completed" aria-label="edit">
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              (click)="onCustom({ action: 'delete', data: todo })"
              aria-label="delete"
              [disabled]="todo.completed"
              [matTooltip]="todo.completed ? ('tasks.completedLock' | transloco) : ('common.delete' | transloco)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>

    <mat-paginator
      [length]="total"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="[5, 10, 20]"
      (page)="onPageChange($event)"
    ></mat-paginator>
  </section>
</div>
