<div class="page-header">
  <div>
    <p class="eyebrow">{{ 'persons.eyebrow' | transloco }}</p>
    <h1>{{ 'persons.title' | transloco }}</h1>
    <p class="muted">{{ 'persons.subtitle' | transloco }}</p>
  </div>
  <div class="flex gap-3">
    <button mat-stroked-button color="primary" (click)="loadPersons()" [disabled]="loading">
      <mat-icon>refresh</mat-icon>
      {{ 'common.refresh' | transloco }}
    </button>
    <button mat-flat-button color="primary" (click)="openDialog()">
      <mat-icon>add</mat-icon>
      {{ 'common.add' | transloco }}
    </button>
  </div>
</div>

<mat-card class="shadow-sm">
  <div class="p-4 flex flex-col gap-4">
    <div class="grid md:grid-cols-3 gap-3 items-start">
      <mat-form-field appearance="outline" class="w-full md:w-80">
        <mat-label>{{ 'persons.searchName' | transloco }}</mat-label>
        <input matInput [(ngModel)]="search" (keyup.enter)="applySearch()" placeholder="ex: Alice" />
        <button mat-icon-button matSuffix *ngIf="search" (click)="search=''; applySearch()" aria-label="Effacer">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full md:w-80">
        <mat-label>{{ 'persons.searchEmail' | transloco }}</mat-label>
        <input matInput [(ngModel)]="searchEmail" (keyup.enter)="applySearch()" placeholder="ex: @example.com" />
        <button mat-icon-button matSuffix *ngIf="searchEmail" (click)="searchEmail=''; applySearch()" aria-label="Effacer">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <div class="flex gap-2 filter-actions">
        <button mat-stroked-button color="primary" (click)="applySearch()" [disabled]="loading">
          <mat-icon>search</mat-icon>
          {{ 'common.filter' | transloco }}
        </button>
        <button mat-button (click)="search=''; searchEmail=''; applySearch()" [disabled]="loading">
          {{ 'common.reset' | transloco }}
        </button>
      </div>
    </div>

    <ng2-smart-table
      [settings]="settings"
      [source]="source"
      (custom)="onCustom($event)"
      class="smart-table"
    ></ng2-smart-table>

    <mat-paginator
      [length]="total"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="[5, 10, 20]"
      (page)="onPageChange($event)"
    ></mat-paginator>
  </div>
</mat-card>
